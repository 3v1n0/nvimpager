#!/bin/sh

RUNTIME=${0%/*}
export RUNTIME
# Save the current process ID to enable the nvim process to write to our
# stdout via the proc filesystem.
PID=$$
export PID

if [ $# -eq 0 -o ! -t 0 ]; then
  set -- "$@" -
fi

rc=~/.config/nvim/pagerrc.vim
if [ ! -r "$rc" ]; then
  rc=NORC
fi

nvim \
  -R \
  -u "$rc" \
  --cmd 'set rtp^=$RUNTIME' \
  --cmd 'call pager#start()' \
  -c 'call pager#start2()' \
  -c 'call cat#prepare()' \
  "$@" \
  >/dev/null
